# CUSTOM VM KERNEL PARAMETERS
# ---------------------------

#===== EMULATION OPTIONS TO RUN THE KERNEL IN QEMU

# Allow docker to load images that lsetxattr
CONFIG_SECURITY_FILE_CAPABILITIES=y
CONFIG_EXT4_FS=y
CONFIG_EXT4_FS_XATTR=y
CONFIG_EXT4_FS_SECURITY=y
CONFIG_EXT4_FS_POSIX_ACL=y

# Special options to allow virtual devices working in Qemu
CONFIG_BLOCK=y
CONFIG_BLK_DEV=y
CONFIG_DEVTMPFS=y
CONFIG_VIRTIO_MENU=y
CONFIG_VIRTIO_BLK=y
CONFIG_VIRTIO_NET=y

# Activate serial devices
CONFIG_SERIAL_AMBA_PL011=y
CONFIG_SERIAL_AMBA_PL011_CONSOLE=y

#====== OPTIMIZE KERNEL SIZE (by disabling graphics)

# Disable Direct Rendering Manager (DRM)
CONFIG_DRM=n

# Disable specific GPU drivers
CONFIG_DRM_NOUVEAU=n  # NVIDIA open-source driver
CONFIG_DRM_RADEON=n   # AMD open-source driver
CONFIG_DRM_AMDGPU=n   # Newer AMD driver
CONFIG_DRM_INTEL=n    # Intel graphics driver

# Disable framebuffer support
CONFIG_FB=n

# Disable specific framebuffer drivers
CONFIG_FB_VESA=n
CONFIG_FB_EFI=n

# Disable console graphics
CONFIG_FRAMEBUFFER_CONSOLE=n
CONFIG_LOGO=n

# Disable video output support
CONFIG_VIDEO_OUTPUT_SUPPORT=n

#===== DOCKER USEFUL

# Namespaces
CONFIG_NAMESPACES=y
CONFIG_NET_NS=y
CONFIG_PID_NS=y
CONFIG_IPC_NS=y
CONFIG_UTS_NS=y

# Group control options
CONFIG_CGROUPS=y
CONFIG_CGROUP_CPUACCT=y
CONFIG_CGROUP_DEVICE=y
CONFIG_CGROUP_FREEZER=y
CONFIG_CGROUP_HUGETLB=y
CONFIG_CGROUP_PIDS=y

# Memory management
CONFIG_MEMCG=y

# Allow docker to be started in the virtual machine,
# in combination with { "bridge": "none" } in /etc/docker/daemon.json
CONFIG_OVERLAY_FS=y
CONFIG_NF_TABLES=y
CONFIG_NF_TABLES_IPV4=y

# Network and IP management
CONFIG_BRIDGE=y
CONFIG_NETFILTER=y
CONFIG_NETFILTER_ADVANCED=y
CONFIG_NETFILTER_FAMILY_BRIDGE=y
CONFIG_NETFILTER_NETLINK=y
CONFIG_NETFILTER_XT_MATCH_IPVS=y

# IP Management
CONFIG_IPV6=y
CONFIG_IP6_NF_FILTER=y
CONFIG_IP6_NF_NAT=y
CONFIG_IP6_NF_IPTABLES=y

CONFIG_NF_TABLES_IPV6=y
CONFIG_NF_TABLES_BRIDGE=y
CONFIG_IP_NF_IPTABLES=y
CONFIG_IP_NF_FILTER=y
CONFIG_IP_NF_NAT=y

CONFIG_IP_MULTIPLE_TABLES=y
CONFIG_IP_ADVANCED_ROUTER=y
CONFIG_IP_VS=y
CONFIG_VETH=y

# POTENTIALLY USEFUL
# ----------

# CONFIG_NET_IP_TUNNEL=y
# CONFIG_INET_TUNNEL=y


# CONFIG_INET6_TUNNEL=y
# CONFIG_IPV6_VTI=y
# CONFIG_IPV6_SIT=y

# CONFIG_BRIDGE_NETFILTER=y

# CONFIG_NETFILTER_NETLINK=y
# CONFIG_NETFILTER_FAMILY_ARP=y

# CONFIG_NF_CONNTRACK=y
# CONFIG_NF_NAT=y


# CONFIG_NF_TABLES_INET=y
# CONFIG_NF_TABLES_NETDEV=y

# CONFIG_NFT_MASQ=y
# CONFIG_NFT_NAT=y

# CONFIG_NETFILTER_XTABLES=y
# CONFIG_NETFILTER_XT_TARGET_AUDIT=y

# CONFIG_NETFILTER_XT_NAT=y
# CONFIG_NETFILTER_XT_TARGET_MASQUERADE=y

# CONFIG_NETFILTER_XT_MATCH_ADDRTYPE=y
# CONFIG_NETFILTER_XT_MATCH_CONNTRACK=y
# CONFIG_NETFILTER_XT_MATCH_POLICY=y
# CONFIG_NETFILTER_XT_MATCH_RECENT=y
# CONFIG_NETFILTER_XT_MATCH_SOCKET=y
# CONFIG_NETFILTER_XT_MATCH_STATE=y

# CONFIG_NF_DEFRAG_IPV4=y
# CONFIG_NF_SOCKET_IPV4=y
# CONFIG_NF_TABLES_ARP=y


# CONFIG_IP_NF_TARGET_MASQUERADE=y

# CONFIG_NF_SOCKET_IPV6=y

# CONFIG_IP6_NF_TARGET_MASQUERADE=y

# CONFIG_NF_DEFRAG_IPV6=y
# CONFIG_NF_CONNTRACK_BRIDGE=y
# CONFIG_BRIDGE_NF_EBTABLES=y

# CONFIG_BRIDGE_NF_EBTABLES=y

# CONFIG_STP=y

# CONFIG_LLC=y

# CONFIG_SECURITY=y
# CONFIG_CRYPTO=y

# CONFIG_NAMESPACES=y
# CONFIG_USER_NS=y

# CONFIG_FS_POSIX_ACL=y
# CONFIG_FS_SECURITY=y
# CONFIG_KEYS=y
# CONFIG_SECURITYFS=y
